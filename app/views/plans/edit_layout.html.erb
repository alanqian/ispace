<h1>空间设计</h1>

<hr>
<%= link_to "Test Update init_facing=4", plan_path(@plan, "plan[init_facing]" => 4), method: :put %>
<hr>

<h2>Test Toolbar</h2>

<%# tools:
  set facings for select products.
  check sale_type: 必卖品
  plan#publish,
%>

<hr>

<% buttons = [
  #--- the 1st row, 20x18 ---
  "plan-new",
  "plan-edit-summary",
  "plan-publish",     #
  "plan-copy-to",     # dup the plan to other model stores
  "position-facing-inc",
  "position-facing-dec",
  "position-remove",
  "positions-reorder",# Products can be repositioned in a different order
                      # within a shelf or from a combination of shelves.
                      # Select the products in the order that you want them to appear on
                      # the shelf. (The first product selected will be first in traffic flow).
  "position-edit-leading-gaps",  # ?: show dialog
  "position-edit-dividers", # ?: show dialog

  "switch-product-information", # switch the info on right/bottom/hide
  "sort", # ??
  "select-showing-information", # product infobox or product list on bottom
  "switch-show-colors", # (brand/manufacture/product/supplier)
] %>

<%# [
  #--- without image ---
  "position-new",
  "shelf-combine",
  "shelf-break",
  "peg-equalize-spacing",
  "peg-close-up-spacing",
  "peg-line-up-spacing",
  "chest-auto-pack",
  "chest-repack",
  "chest-repack-all",
  "chest-options",
  "switch-peg-holes",
  "undo",
] %>

<div id="plan_toolbar" class="ui-widget-header ui-corner-all">
  <% buttons.each do |btn| %>
    <%= button_tag btn, type: :button, id: btn, class: "toolbar-button",
      data: { icon: "ui-#{btn}" } %>
  <% end %>
</div>

<%#
  fixture view:
    from left to right: bay 1 -> bay 2 -> ...
    from top to bottom: space, shelf, space, shelf, ..., space, shelf, base
%>
<div id="products-container">
  <%= render "/fixtures/layout", fixture: @plan.fixture %>
</div>

<%#
  all positions are stored in ajax-form; #plan-layout-form
  init:
    position slots;
    create LIs from positions, move to proper slots(fixture_item_id, layer) in fixtures;
  edit:
    when sortable changed, we mark the form dirty;
  save(submit):
    save all positions by the items in fixture slots, than submit;
  auto_save:
    auto_save by a timer, save every 1 minute;


  # slot:
  <ul id="slot-4-6" data-container="#space-4-6"
      data-fixture-item="4"
      data-layer="6"
      data-space="{&quot;merch_width&quot;:&quot;120.0&quot;,&quot;merch_depth&quot;:&quot;46.0&quot;,&quot;merch_height&quot;:&quot;20.0&quot;,&quot;shelf_height&quot;:&quot;5.0&quot;,&quot;from_base&quot;:&quot;131.0&quot;,&quot;shelf_color&quot;:&quot;#dfdfdf&quot;}"
      class="sortable-editor sortable-container ui-sortable"
      style="width: 600.3333333730698px; height: 40.33333337306976px; top: 341.9375px; left: 434.58331298828125px;"></ul>
  # input:
  <input id="plan_positions_attributes_0_id"
    name="plan[positions_attributes][0][id]" type="hidden" value="96">
  # ==>
  # group by (fixture_item_id, layer), sort by seq_num
  <li id="pos_0" class="sortable-item"
    title="" # by product id
    data-id="#{position_id}">
    <table>..</table>
  </li>

  <input id="plan_positions_attributes_0_fixture_item_id"
         name="plan[positions_attributes][0][fixture_item_id]" type="hidden" value="-1">
%>
<div id="plan-edit-layout-form">
  <%= render 'form_layout' %>
</div>

<hr/>

<div id="info-box" class="ui-widget-content ui-corner-all ui-draggable1 ui-resizable1">
  <h3 class="ui-widget-header">Product Info Box</h3>
  <p>blah, blah</p>
</div>

<div id="products-data"
  data-meta="<%= products.to_hash(:id, :code, :name, :price_zone, :height, :width, :depth).to_json %>"
  class="ui-corner-all">
  <%= render "/products/list",
      products: products,
      brands_all: brands_all,
      suppliers_all: suppliers_all,
      mfrs_all: mfrs_all,
      sinfoempty: "无结果，试试更改搜索词，重新搜索" %>
</div>

<%#= render 'sortable_test' %>
<%#= render 'toolbar_test' %>
