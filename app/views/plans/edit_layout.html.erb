<h1>空间设计</h1>

<hr>
<%= link_to "Test Update init_facing=4", plan_path(@plan, "plan[init_facing]" => 4), method: :put %>
<hr>

<h2>Test Toolbar</h2>

<%# tools:
  set facings for select products.
  check sale_type: 必卖品
  plan#publish,
%>

<hr>

<% buttons = [
  #--- the 1st row, 20x18 ---
  # ["plan-save", "ui-icon-disk"],
   "plan-save",
  ["plan-edit-summary", "ui-icon-comment"],
  # ["plan-publish", "ui-icon-circle-check"],    #
  "plan-publish",
  "plan-copy-to",     # dup the plan to other model stores
  "position-facing-inc",
  "position-facing-dec",
  "position-remove",
  "positions-reorder",# Products can be repositioned in a different order
                      # within a shelf or from a combination of shelves.
                      # Select the products in the order that you want them to appear on
                      # the shelf. (The first product selected will be first in traffic flow).
  "position-edit-leading-gaps",  # ?: show dialog
  "position-edit-dividers", # ?: show dialog

  "switch-product-information", # switch the info on right/bottom/hide
  "sort", # ??
  "select-showing-information", # product infobox or product list on bottom
  "switch-show-colors", # (brand/manufacture/product/supplier)
] %>

<%# [
  #--- without image ---
  "position-new",
  "shelf-combine",
  "shelf-break",
  "peg-equalize-spacing",
  "peg-close-up-spacing",
  "peg-line-up-spacing",
  "chest-auto-pack",
  "chest-repack",
  "chest-repack-all",
  "chest-options",
  "switch-peg-holes",
  "undo",
] %>

<div id="plan_toolbar" class="ui-widget-header ui-corner-all">
  <%= select_tag "plan-switch-model-store",
    options_from_collection_for_select(@plan.plan_set.model_stores_opt, "id", "name", @plan.id),
    class: "toolbar-select" %>
  <% buttons.each do |btn| %>
    <%
      if btn.kind_of?(Array)
        text, icon = btn
      else
        text = btn
        icon = "ui-#{btn}"
      end
      %>
    <%= button_tag text, type: :button, id: text, class: "toolbar-button",
      data: { icon: icon } %>
  <% end %>
</div>

<%#
  fixture view:
    from left to right: bay 1 -> bay 2 -> ...
    from top to bottom: space, shelf, space, shelf, ..., space, shelf, base
%>
<div id="products-container">
  <%= render "/fixtures/layout", fixture: @plan.fixture %>
</div>

<%#
  all positions are stored in ajax-form; #plan-layout-form
  init:
    position slots;
    create LIs from positions, move to proper slots(fixture_item_id, layer) in fixtures;
  edit:
    when sortable changed, we mark the form dirty;
  save(submit):
    save all positions by the items in fixture slots, than submit;
  auto_save:
    auto_save by a timer, save every 1 minute;


  # slot:
  <ul id="slot-4-6" data-container="#space-4-6"
      data-fixture-item="4"
      data-layer="6"
      data-space="{&quot;merch_width&quot;:&quot;120.0&quot;,&quot;merch_depth&quot;:&quot;46.0&quot;,&quot;merch_height&quot;:&quot;20.0&quot;,&quot;shelf_height&quot;:&quot;5.0&quot;,&quot;from_base&quot;:&quot;131.0&quot;,&quot;shelf_color&quot;:&quot;#dfdfdf&quot;}"
      class="sortable-editor sortable-container ui-sortable"
      style="width: 600.3333333730698px; height: 40.33333337306976px; top: 341.9375px; left: 434.58331298828125px;"></ul>
  # input:
  <input id="plan_positions_attributes_0_id"
    name="plan[positions_attributes][0][id]" type="hidden" value="96">
  # ==>
  # group by (fixture_item_id, layer), sort by seq_num
  <li id="pos_0" class="sortable-item"
    title="" # by product id
    data-id="#{position_id}">
    <table>..</table>
  </li>

  <input id="plan_positions_attributes_0_fixture_item_id"
         name="plan[positions_attributes][0][fixture_item_id]" type="hidden" value="-1">
%>

<div id="plan-edit-layout-form">
  <%= render 'form_layout' %>
  <%= render 'form_publish' %>
</div>

<hr/>

<div id="info-box" class="ui-widget-content ui-corner-all ui-draggable1 ui-resizable1">
  <h3 class="ui-widget-header">Product Info Box</h3>
  <p>blah, blah</p>
</div>

<div id="products-data"
  data-products="<%= products.to_hash(:id, :code, :name, :price_zone, :height, :width, :depth, :supplier_id, :brand_id, :mfr_id).to_json %>"
  data-brands="<%= brands_all.to_hash(:id, :color).to_json %>"
  data-mfrs="<%= mfrs_all.to_hash(:id, :color).to_json %>"
  data-suppliers="<%= suppliers_all.to_hash(:id, :color).to_json %>"
  class="ui-corner-all">
  <%= render "/products/list",
      products: products,
      brands_all: brands_all,
      suppliers_all: suppliers_all,
      mfrs_all: mfrs_all,
      sinfoempty: "无结果，试试更改搜索词，重新搜索" %>
</div>

<div id="plan-edit-summary-dialog" class="ui-helper-hidden"
  title="修改规划基本信息" >
  <%= render 'form_summary' %>
</div>

<div id="plan-copy-to-dialog" class="ui-helper-hidden"
  title="复制空间规划" >
  <%= render 'form_copy_to' %>
</div>

<div id="plan-positions-gap-dialog" class="ui-helper-hidden"
  title="修改货品间隙" >
  <%= render 'form_positions_gap' %>
</div>

<div id="plan-positions-divider-dialog" class="ui-helper-hidden"
  title="设置货品分隔物" >
  <%= render 'form_positions_divider' %>
</div>

<div id="plan-publish-confirm" title="发布规划?">
<p>
<span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>
发布本样板店(<%= @plan.store_name %>)的空间规划，发布后将结束编辑状态，相应的门店可以下载，请确认！</p>
</div>

<ul id="showing-colors-menu" class="popup-menu">
  <li><a id="show-brand-color" href="#">品牌颜色</a></li>
  <li><a id="show-product-color" href="#">产品颜色</a></li>
  <li><a id="show-manufacturer-color" href="#">生产商颜色</a></li>
  <li><a id="show-supplier-color" href="#">供应商颜色</a></li>
</ul>

<%#= render 'sortable_test' %>
<%#= render 'toolbar_test' %>
