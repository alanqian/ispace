<%# todo: publish, unpublish %>
<%# name, to_deploy_at, published_at, deployed_stores, undeployed_stores %>
<table id="plan_sets_deploying"
  data-sinfo="共找到_TOTAL_个规划"
  data-sinfoempty="未找到部署中的规划，请重新搜索或发布规划"
  class="dataTable grid-control no-wrap plan_sets deploying" cellspacing=0>
  <thead>
    <tr>
      <%=data_th_list :plan_set,
        :name,
        [:completed_ratio, sort: false],
        :published_at,
        :to_deploy_at,
        [:deployed, sort: false],
        [:download, sort: false],
        [:none, sort: false],
        ["", sort: false]
      %>
    </tr>
  </thead>
  <tbody>
    <% deployments.each do |it| %>
      <%
        dpm = OpenStruct.new(it)
        plan_set = dpm.plan_set
        completed_ratio = "#{dpm.deployed.size}/#{dpm.count}"
      %>
      <tr>
        <%= data_td_list dpm,
          link_to(plan_set.full_name, plan_set_path(plan_set, _do: :deploy)),
          completed_ratio,
          dt_ago(plan_set.published_at.localtime),
          plan_set.to_deploy_at,
          deploy_stores(dpm, :deployed),
          deploy_stores(dpm, :download),
          deploy_stores(dpm, :none),
          link_to("撤销发布", edit_plan_set_path(plan_set, _do: :publish, off: 1))
        %>
      </tr>
    <% end %>
  </tbody>
</table>
